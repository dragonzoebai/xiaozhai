<!doctype html>
<html lang="en">
	<head>
		<title>管网充满度</title>
		<link rel="stylesheet"
			href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/css/ol.css"
			type="text/css">
		<style>
			html,
			body,
			.map {
				height: 100%;
				width: 100%;
				margin: 0;
				padding: 0
			}
		</style>
	</head>
	<body>
		<div id="map" class="map"></div>
	</body>
	<script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/build/ol.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
		var basePath = 'https://xz.csceccloud.net:10000/arcgis/rest'
		var urlTile = basePath + '/services/xiaozhaimap_dark/MapServer';

		/**
		 * 高德底图
		 */
		var gaodeMapLayer = new ol.layer.Tile({
			source: new ol.source.XYZ({
				url: 'http://t0.tianditu.com/vec_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=vec&tileMatrixSet=w&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk=40b190683706230fade806c1ac8c14e8'
				// url: 'http://wprd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scl=2&style=7&x={x}&y={y}&z={z}'
			}),
			visible: true
		});

		/**
		 * wms底图
		 */
		var tileLayer = new ol.layer.Tile({
			source: new ol.source.TileArcGISRest({
				url: urlTile,
			}),
		});
		
		var serviceUrlPipeNetwork = basePath + '/services/管网充满度/MapServer/0/query'
		// 管线数据
		var stylePipeNetwork = {
			'1': new ol.style.Style({
				stroke: new ol.style.Stroke({
					color: 'rgba(255, 0, 0, 1)',
					width: 3,
				}),
			}),
			'2': new ol.style.Style({
				stroke: new ol.style.Stroke({
					color: 'rgba(0, 255, 0, 1)',
					width: 3,
				}),
			}),
			'3': new ol.style.Style({
				stroke: new ol.style.Stroke({
					color: 'rgba(255, 255, 0,  1)',
					width: 3,
				}),
			})
		};
		var vectorSourcePipeNetwork = new ol.source.Vector({
			format: new ol.format.GeoJSON(),
			url: "./P1.json",
			// strategy: ol.loadingstrategy.bbox
		});
		
		var vectorLayerPipeNetwork = new ol.layer.Vector({
			minZoom: 12,
			// maxZoom: 17,
			source: vectorSourcePipeNetwork,
			style: function(feature) {
				// console.log(feature.get('Results'))
				var results = feature.get('Results');
				if(results<0.2){
					return stylePipeNetwork[2];
				}else if(results<0.4){
					return stylePipeNetwork[3];
				}
				return stylePipeNetwork[1];
			},
		});
		
		/**
		 * 创建地图对象并添加图层
		 */
		var map = new ol.Map({
			target: 'map',
			controls: ol.control.defaults({
				zoom: false
			}),
			layers: [gaodeMapLayer, tileLayer, vectorLayerPipeNetwork],
			view: new ol.View({
				// center: transform([120.27860371, 31.87002056]),
				center: [108.948301, 34.223445],
				projection: 'EPSG:4326',
				zoom: 15,
			})
		});

		function transform(pois) {
			return ol.proj.transform(pois, 'EPSG:4326', 'EPSG:3857')
		}

	</script>
</html>
