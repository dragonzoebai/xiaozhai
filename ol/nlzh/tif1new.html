<!doctype html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>内涝灾害-tif动画</title>
		<link rel="stylesheet"
			href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/css/ol.css"
			type="text/css">
		<style>
			html,
			body,
			.map {
				height: 100%;
				width: 100%;
				margin: 0;
				padding: 0
			}
		</style>
	</head>
	<body>
		<div id="map" class="map"></div>
		<div style="position: absolute;top: 10px;left: 10px;">
			<span id="spanMarker" style="background-color: #000000;color: #ffffff;"></span>
		</div>
	</body>
	<script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/build/ol.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
		var basePath = 'https://xz.csceccloud.net:10000/arcgis/rest'
		var urlTile = basePath + '/services/xiaozhaimap_dark/MapServer';

		/**
		 * wms底图
		 */
		var tileLayer = new ol.layer.Tile({
			source: new ol.source.TileArcGISRest({
				url: urlTile,
			}),
		});

		/**
		 * 创建地图对象并添加图层
		 */
		var map = new ol.Map({
			target: 'map',
			controls: ol.control.defaults({
				zoom: false
			}),
			layers: [tileLayer], // tileLayer
			view: new ol.View({
				center: transform([108.948301, 34.223445]),
				// center: [108.948301, 34.223445],
				// projection: 'EPSG:4326',
				zoom: 14.5,
			})
		});

		function transform(pois) {
			return ol.proj.transform(pois, 'EPSG:4326', 'EPSG:3857')
		}
		
		var base_url = 'https://xz.csceccloud.net:10000/geoserver/';
		var wmtsLayer = new ol.layer.Tile({
			source: new ol.source.TileWMS({
				url: base_url + "/xiaozhai/wms",
				params: {
					'LAYERS': 'xiaozhai:A50-0', //
					'TILED': true
				}
			}),
			map: map
		})
		function changeData(layer) {
			wmtsLayer.getSource().getParams().LAYERS="xiaozhai:"+layer
			wmtsLayer.getSource().refresh()
		}
		
		var tileLayer = new ol.layer.Tile({
			source: new ol.source.XYZ({
				// url: url
			}),
			visible: true,
			map: map
		});
		function changeData2(layer) {
			url = base_url + '/gwc/service/wmts?' +
				'layer=xiaozhai:' + layer + '&style=&tilematrixset=EPSG:900913&' +
				'Service=WMTS&Request=GetTile&Version=1.0.0&Format=image/png&' +
				'TileMatrix=EPSG:900913:{z}&TileCol={x}&TileRow={y}';
			tileLayer.getSource().setUrl(url)
		}
		
		var tifIndex = 0
		setInterval(()=>{
			$("#spanMarker").html("运行中: " + tifIndex + " 帧")
			// changeData("A50-"+tifIndex)
			changeData2("A50-"+tifIndex)
			if(tifIndex==11){
				tifIndex = 0
			}
			tifIndex ++;
		},1000)


		
	</script>
</html>
